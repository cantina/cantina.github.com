<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>node_modules&#x2F;cantina-views&#x2F;lib&#x2F;plugin.js - Cantina</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.5.1&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.5.1&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title="Cantina"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.4.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/app.html">app</a></li>
            
                <li><a href="..&#x2F;classes/app.views.html">app.views</a></li>
            
                <li><a href="..&#x2F;classes/cantina.html">cantina</a></li>
            
                <li><a href="..&#x2F;classes/cantina.cli.html">cantina.cli</a></li>
            
                <li><a href="..&#x2F;classes/cantina.plugins.controllers.html">cantina.plugins.controllers</a></li>
            
                <li><a href="..&#x2F;classes/cantina.plugins.http.html">cantina.plugins.http</a></li>
            
                <li><a href="..&#x2F;classes/cantina.plugins.middleware.html">cantina.plugins.middleware</a></li>
            
                <li><a href="..&#x2F;classes/cantina.plugins.utils.html">cantina.plugins.utils</a></li>
            
                <li><a href="..&#x2F;classes/views.html">views</a></li>
            
                <li><a href="..&#x2F;classes/views.plugin.html">views.plugin</a></li>
            
                <li><a href="..&#x2F;classes/views.plugin.helpers.html">views.plugin.helpers</a></li>
            
                <li><a href="..&#x2F;classes/views.plugin.partials.html">views.plugin.partials</a></li>
            
                <li><a href="..&#x2F;classes/views.plugin.registry.html">views.plugin.registry</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/cantina.html">cantina</a></li>
            
                <li><a href="..&#x2F;modules/views.html">views</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: node_modules&#x2F;cantina-views&#x2F;lib&#x2F;plugin.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;**
 * Cantina Views - Plugin
 * ----------------------
 *
 * Provides a full-featured system for discovering and rendering views.
 *
 * Templates are rendered with consolidate.js (Express 3.0&#x27;s template engine).
 *
 * @module cantina
 * @submodule views
 *&#x2F;

var path = require(&#x27;path&#x27;),
    util = require(&#x27;util&#x27;),
    cons = require(&#x27;consolidate&#x27;);

&#x2F;&#x2F; Expose this service&#x27;s package info.
require(&#x27;pkginfo&#x27;)(module);

&#x2F;**
 * Views Plugin
 * ------------
 *
 * Provides a full-featured system for discovering and rendering views.
 *
 * @class views.plugin
 *&#x2F;
var views = module.exports = {
  name: &#x27;views&#x27;,
  description: &#x27;Discover and render views&#x27;
};

&#x2F;**
 * Attach the views plugin to an application.
 *
 * Loads the following sub-plugins:
 *
 *   - &#x60;views.plugin.helpers&#x60;
 *   - &#x60;views.plugin.registry&#x60;
 *   - &#x60;views.plugin.partials&#x60;
 *
 * Registers the root views namespace (based on options or the defaults).
 *
 * Exposes &#x60;app.views&#x60; and &#x60;app.render()&#x60;.
 *
 * @method  attach
 * @param  options {Object} Plugin options.
 * @for views.plugin
 *&#x2F;
views.attach = function(options) {
  var app = this;

  if (app.mode !== &#x27;http&#x27;) {
    throw new Error(&#x27;The views plugin can only be used with &#x60;http&#x60; apps.&#x27;);
  }

  &#x2F;**
   * Views API
   * ---------
   *
   * Application-level api for registering views namespaces, partials, and
   * helpers.
   *
   * @class app.views
   *&#x2F;
  app.views = app.views || {};

  &#x2F;&#x2F; Default options.
  options = options || {};
  app.utils.defaults(options, {
    path: &#x27;lib&#x2F;views&#x27;,
    layout: &#x27;layout&#x27;,
    ext: &#x27;hbs&#x27;,
    engine: &#x27;handlebars&#x27;
  });
  app.views.options = options;

  &#x2F;**
   * Stringify a path, preparing it to be converted to new RegExp.
   *
   * @method _stringifyPath
   * @private
   * @param path {String|RegExp} The string or regular expression to normalize.
   * @return {String} The normalized string representation of the path.
   * @for app.views
   *&#x2F;
  app.views._stringifyPath = function(path) {
    &#x2F;&#x2F; Convert to string and clean up if its a regex.
    if (util.isRegExp(path)) {
      path = path.toString().replace(&#x2F;^\&#x2F;&#x2F;, &#x27;&#x27;).replace(&#x2F;\&#x2F;$&#x2F;, &#x27;&#x27;);
    }
    &#x2F;&#x2F; Make sure the path will be matched in-full.
    else {
      path = &#x27;^&#x27; + path + &#x27;$&#x27;;
    }
    return path;
  }

  &#x2F;&#x2F; Load the helpers plugin.
  app.use(require(&#x27;.&#x2F;helpers&#x27;), options);

  &#x2F;&#x2F; Load the registry plugin.
  app.use(require(&#x27;.&#x2F;registry&#x27;), options);

  &#x2F;&#x2F; Load the patials plugin.
  app.use(require(&#x27;.&#x2F;partials&#x27;), options);

  &#x2F;&#x2F; Register the root namespace.
  app.views.register(&#x27;&#x27;, path.join(app.root, options.path), options);

  &#x2F;**
   * Render views.
   *
   * This function is available in the &#x27;router&#x27; scope (ie &#x60;this&#x60; in a route
   * handler).  It is NOT available on &#x60;app&#x60;.
   *
   * @method render
   * @param view {String} The path to a template, relative to ANY registered
   *   views namespace, excluding the template extension.
   * @param opts {Object} Template data and&#x2F;or engine-specific options.
   * @param [cb] {Function} (err, str) Callback to handle the rendered text. A
   *   default callback is provided which calls &#x60;this.res.html(str)&#x60;.
   * @for app
   *
   * @example
   *     var app = cantina.app;
   *     app.use(require(&#x27;cantina-views&#x27;).plugin);
   *
   *     &#x2F;&#x2F; The default cantina-views options assume you have a .&#x2F;lib&#x2F;views
   *     &#x2F;&#x2F; directory and registers it as the &#x27;root&#x27; namespace.  Templates
   *     &#x2F;&#x2F; inside the registered directory can then be rendered like:
   *
   *     app.router.get(&#x27;&#x2F;&#x27;, function() {
   *       this.render(&#x27;index&#x27;, {title: &#x27;A title&#x27;, body: &#x27;The Body&#x27;})
   *     });
   *&#x2F;
  function render(view, opts, cb) {
    var self = this,
        opts = opts || {},
        res = this.res,
        app = this.app,
        template,
        tasks = [];

    &#x2F;&#x2F; Support callback function as second argument.
    if (typeof opts === &#x27;function&#x27;) {
      cb = opts, opts = {};
    }

    &#x2F;&#x2F; If opts is a string, assign it to opts.content.
    if (typeof opts === &#x27;string&#x27;) {
      opts = {content: opts};
    }

    &#x2F;&#x2F; Merge in application default view options.
    app.utils.defaults(opts, app.views.options);

    &#x2F;&#x2F; Default render callback.
    cb = cb || function(err, str) {
      &#x2F;&#x2F; If we have a layout, and this is not the layout, render this
      &#x2F;&#x2F; content inside the layout.
      if (opts.layout &amp;&amp; view !== opts.layout) {
        self.render(opts.layout, str);
      }
      else {
        res.html(str);
      }
    };

    &#x2F;&#x2F; Find the full path to the template.
    if (template = app.views.find(view, opts)) {
      &#x2F;&#x2F; Process view helpers.
      app.views._processHelpers.call(self, opts, function(err) {
        if (err) throw err;
        app.views._processPartials.call(self, opts, function(err) {
          if (err) throw err;
          cons[opts.engine](template, opts, cb);
        });
      });
    }
    else {
      cb(new Error(&#x27;Could not find the requested view: &#x27; + view));
    }
  }

  &#x2F;&#x2F; Attach the render function.
  if (app.router) {
    app.router.attach(function() {
      this.render = render.bind(this);
    });
  }
};

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
